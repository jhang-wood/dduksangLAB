name: ğŸ“± ëª¨ë°”ì¼ ë° ë°˜ì‘í˜• í…ŒìŠ¤íŠ¸

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]
  schedule:
    - cron: '30 1 * * *'  # ë§¤ì¼ ì˜¤ì „ 10:30 (KST)
  workflow_dispatch:
    inputs:
      device_scope:
        description: 'í…ŒìŠ¤íŠ¸ ë””ë°”ì´ìŠ¤ ë²”ìœ„'
        required: true
        default: 'standard'
        type: choice
        options:
          - minimal
          - standard
          - comprehensive

env:
  NODE_VERSION: '20'

jobs:
  # ë°˜ì‘í˜• ë””ìì¸ í…ŒìŠ¤íŠ¸
  responsive-design:
    name: ğŸ“ ë°˜ì‘í˜• ë””ìì¸ í…ŒìŠ¤íŠ¸
    runs-on: ubuntu-latest
    timeout-minutes: 25
    
    strategy:
      matrix:
        viewport:
          - { name: 'Mobile Portrait', width: 375, height: 667, device: 'iPhone SE' }
          - { name: 'Mobile Landscape', width: 667, height: 375, device: 'iPhone SE Landscape' }
          - { name: 'Tablet Portrait', width: 768, height: 1024, device: 'iPad' }
          - { name: 'Tablet Landscape', width: 1024, height: 768, device: 'iPad Landscape' }
          - { name: 'Desktop', width: 1920, height: 1080, device: 'Desktop' }
          - { name: 'Large Desktop', width: 2560, height: 1440, device: '2K Display' }
        
    steps:
      - name: ğŸ“¥ ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4

      - name: ğŸ”§ Node.js ì„¤ì •
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: ğŸ“¦ ì˜ì¡´ì„± ì„¤ì¹˜
        run: |
          npm ci --no-audit --no-fund
          npx playwright install chromium

      - name: ğŸ—ï¸ ë¹Œë“œ
        run: npm run build

      - name: ğŸš€ ì„œë²„ ì‹œì‘
        run: |
          npm start &
          SERVER_PID=$!
          echo "SERVER_PID=$SERVER_PID" >> $GITHUB_ENV
          
          echo "â³ ì„œë²„ ì‹œì‘ ëŒ€ê¸°..."
          for i in {1..30}; do
            if curl -s http://localhost:3000 > /dev/null; then
              echo "âœ… ì„œë²„ ì¤€ë¹„ ì™„ë£Œ"
              break
            fi
            sleep 2
          done

      - name: ğŸ“± ë°˜ì‘í˜• í…ŒìŠ¤íŠ¸ (${{ matrix.viewport.name }})
        run: |
          cat > responsive-test-${{ matrix.viewport.width }}x${{ matrix.viewport.height }}.js << 'EOF'
          const { test, expect, devices } = require('@playwright/test');
          
          test.describe(`Responsive Test - ${{ matrix.viewport.name }}`, () => {
            test.use({
              viewport: { width: ${{ matrix.viewport.width }}, height: ${{ matrix.viewport.height }} }
            });
          
            const pages = [
              { path: '/', name: 'Home' },
              { path: '/ai-trends', name: 'AI Trends' },
              { path: '/auth/login', name: 'Login' },
              { path: '/auth/signup', name: 'Signup' }
            ];
            
            for (const pageInfo of pages) {
              test(`${pageInfo.name} page responsive layout`, async ({ page }) => {
                await page.goto(`http://localhost:3000${pageInfo.path}`);
                await page.waitForLoadState('networkidle');
                
                // ê¸°ë³¸ ë ˆì´ì•„ì›ƒ ê²€ì¦
                await expect(page.locator('body')).toBeVisible();
                
                // ìˆ˜í‰ ìŠ¤í¬ë¡¤ í™•ì¸ (ëª¨ë°”ì¼ì—ì„œ ì¤‘ìš”)
                const bodyWidth = await page.evaluate(() => document.body.scrollWidth);
                const viewportWidth = ${{ matrix.viewport.width }};
                
                if (bodyWidth > viewportWidth + 50) {
                  console.warn(`âš ï¸ Horizontal scroll detected: ${bodyWidth}px > ${viewportWidth}px`);
                }
                
                // ë°˜ì‘í˜• ë„¤ë¹„ê²Œì´ì…˜ í™•ì¸
                const isMobile = ${{ matrix.viewport.width }} < 768;
                if (isMobile) {
                  // ëª¨ë°”ì¼ì—ì„œ í–„ë²„ê±° ë©”ë‰´ë‚˜ ëª¨ë°”ì¼ ë„¤ë¹„ê²Œì´ì…˜ í™•ì¸
                  const mobileNav = page.locator('[data-testid="mobile-nav"], .mobile-menu, button[aria-label*="menu"]').first();
                  if (await mobileNav.isVisible()) {
                    console.log('âœ… Mobile navigation detected');
                    await mobileNav.click();
                    await page.waitForTimeout(500);
                  }
                } else {
                  // ë°ìŠ¤í¬í†±ì—ì„œ ì¼ë°˜ ë„¤ë¹„ê²Œì´ì…˜ í™•ì¸
                  await expect(page.locator('nav, [role="navigation"]')).toBeVisible();
                }
                
                // í…ìŠ¤íŠ¸ ê°€ë…ì„± í™•ì¸
                const smallTexts = await page.locator('*').evaluateAll(elements => {
                  return elements
                    .filter(el => {
                      const style = window.getComputedStyle(el);
                      const fontSize = parseFloat(style.fontSize);
                      return fontSize > 0 && fontSize < 14 && el.textContent.trim().length > 10;
                    })
                    .map(el => ({
                      text: el.textContent.slice(0, 50),
                      fontSize: window.getComputedStyle(el).fontSize
                    }));
                });
                
                if (smallTexts.length > 0 && ${{ matrix.viewport.width }} < 768) {
                  console.warn('âš ï¸ Small text detected on mobile:', smallTexts.slice(0, 3));
                }
                
                // ìŠ¤í¬ë¦°ìƒ· ì €ì¥
                await page.screenshot({
                  path: `screenshot-${pageInfo.name.toLowerCase()}-${{ matrix.viewport.width }}x${{ matrix.viewport.height }}.png`,
                  fullPage: true
                });
                
                console.log(`âœ… ${pageInfo.name} page tested on ${{ matrix.viewport.device }}`);
              });
            }
          });
          EOF
          
          npx playwright test responsive-test-${{ matrix.viewport.width }}x${{ matrix.viewport.height }}.js --reporter=json:results-${{ matrix.viewport.width }}x${{ matrix.viewport.height }}.json

      - name: ğŸ§¹ ì„œë²„ ì •ë¦¬
        if: always()
        run: |
          if [ -n "$SERVER_PID" ]; then
            kill $SERVER_PID || true
          fi

      - name: ğŸ“¤ ë°˜ì‘í˜• í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì—…ë¡œë“œ
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: responsive-test-${{ matrix.viewport.width }}x${{ matrix.viewport.height }}
          path: |
            screenshot-*.png
            results-*.json
          retention-days: 7

  # í„°ì¹˜ ì¸í„°ë™ì…˜ í…ŒìŠ¤íŠ¸
  touch-interaction:
    name: ğŸ‘† í„°ì¹˜ ì¸í„°ë™ì…˜ í…ŒìŠ¤íŠ¸
    runs-on: ubuntu-latest
    timeout-minutes: 20
    
    steps:
      - name: ğŸ“¥ ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4

      - name: ğŸ”§ Node.js ì„¤ì •
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: ğŸ“¦ ì˜ì¡´ì„± ì„¤ì¹˜
        run: |
          npm ci --no-audit --no-fund
          npx playwright install chromium

      - name: ğŸ—ï¸ ë¹Œë“œ
        run: npm run build

      - name: ğŸš€ ì„œë²„ ì‹œì‘
        run: |
          npm start &
          SERVER_PID=$!
          echo "SERVER_PID=$SERVER_PID" >> $GITHUB_ENV
          
          echo "â³ ì„œë²„ ì‹œì‘ ëŒ€ê¸°..."
          for i in {1..30}; do
            if curl -s http://localhost:3000 > /dev/null; then
              echo "âœ… ì„œë²„ ì¤€ë¹„ ì™„ë£Œ"
              break
            fi
            sleep 2
          done

      - name: ğŸ‘† í„°ì¹˜ ì œìŠ¤ì²˜ í…ŒìŠ¤íŠ¸
        run: |
          cat > touch-interaction-test.js << 'EOF'
          const { test, expect, devices } = require('@playwright/test');
          
          test.describe('Touch Interaction Tests', () => {
            // ëª¨ë°”ì¼ ë””ë°”ì´ìŠ¤ ì‹œë®¬ë ˆì´ì…˜
            test.use(devices['iPhone 13']);
          
            test('Touch targets are adequately sized', async ({ page }) => {
              await page.goto('http://localhost:3000');
              await page.waitForLoadState('networkidle');
              
              // í„°ì¹˜ íƒ€ê²Ÿ í¬ê¸° í™•ì¸ (ìµœì†Œ 44x44px)
              const touchTargets = await page.locator('button, a, input, [role="button"], [onclick]').evaluateAll(elements => {
                return elements.map(el => {
                  const rect = el.getBoundingClientRect();
                  return {
                    element: el.tagName + (el.className ? '.' + el.className.split(' ')[0] : ''),
                    width: rect.width,
                    height: rect.height,
                    adequate: rect.width >= 44 && rect.height >= 44
                  };
                }).filter(target => target.width > 0 && target.height > 0);
              });
              
              const inadequateTargets = touchTargets.filter(target => !target.adequate);
              
              console.log(`ğŸ“Š í„°ì¹˜ íƒ€ê²Ÿ ë¶„ì„:`);
              console.log(`  ì´ ${touchTargets.length}ê°œ í„°ì¹˜ íƒ€ê²Ÿ`);
              console.log(`  ë¶€ì ì ˆí•œ í¬ê¸°: ${inadequateTargets.length}ê°œ`);
              
              if (inadequateTargets.length > 0) {
                console.warn('âš ï¸ ë¶€ì ì ˆí•œ í„°ì¹˜ íƒ€ê²Ÿë“¤:');
                inadequateTargets.slice(0, 5).forEach(target => {
                  console.warn(`  ${target.element}: ${target.width}x${target.height}px`);
                });
                
                if (inadequateTargets.length > touchTargets.length * 0.5) {
                  throw new Error(`Too many inadequate touch targets: ${inadequateTargets.length}/${touchTargets.length}`);
                }
              }
            });
          
            test('Swipe gestures work correctly', async ({ page }) => {
              await page.goto('http://localhost:3000');
              await page.waitForLoadState('networkidle');
              
              // ìŠ¤ì™€ì´í”„ ê°€ëŠ¥í•œ ìš”ì†Œ ì°¾ê¸°
              const swipeableElements = await page.locator('[data-swipeable], .swiper, .carousel, .slider').count();
              
              if (swipeableElements > 0) {
                console.log(`ğŸ“± ${swipeableElements}ê°œì˜ ìŠ¤ì™€ì´í”„ ìš”ì†Œ ë°œê²¬`);
                
                const firstSwipeable = page.locator('[data-swipeable], .swiper, .carousel, .slider').first();
                const box = await firstSwipeable.boundingBox();
                
                if (box) {
                  // ì¢Œì—ì„œ ìš°ë¡œ ìŠ¤ì™€ì´í”„
                  await page.mouse.move(box.x + 50, box.y + box.height / 2);
                  await page.mouse.down();
                  await page.mouse.move(box.x + box.width - 50, box.y + box.height / 2, { steps: 10 });
                  await page.mouse.up();
                  
                  await page.waitForTimeout(500);
                  console.log('âœ… ìŠ¤ì™€ì´í”„ ì œìŠ¤ì²˜ í…ŒìŠ¤íŠ¸ ì™„ë£Œ');
                }
              } else {
                console.log('â„¹ï¸ ìŠ¤ì™€ì´í”„ ìš”ì†Œ ì—†ìŒ');
              }
            });
          
            test('Long press interactions', async ({ page }) => {
              await page.goto('http://localhost:3000');
              await page.waitForLoadState('networkidle');
              
              // ê¸¸ê²Œ ëˆ„ë¥¼ ìˆ˜ ìˆëŠ” ìš”ì†Œë“¤
              const longPressTargets = await page.locator('[data-longpress], .card, .item').count();
              
              if (longPressTargets > 0) {
                const target = page.locator('[data-longpress], .card, .item').first();
                
                // ê¸¸ê²Œ ëˆ„ë¥´ê¸° (1ì´ˆ)
                await target.hover();
                await page.mouse.down();
                await page.waitForTimeout(1000);
                await page.mouse.up();
                
                console.log('âœ… ê¸¸ê²Œ ëˆ„ë¥´ê¸° í…ŒìŠ¤íŠ¸ ì™„ë£Œ');
              } else {
                console.log('â„¹ï¸ ê¸¸ê²Œ ëˆ„ë¥¼ ìˆ˜ ìˆëŠ” ìš”ì†Œ ì—†ìŒ');
              }
            });
          
            test('Pinch zoom behavior', async ({ page }) => {
              await page.goto('http://localhost:3000');
              await page.waitForLoadState('networkidle');
              
              // í•€ì¹˜ ì¤Œ í…ŒìŠ¤íŠ¸ (ì´ë¯¸ì§€ë‚˜ ì§€ë„ ë“±)
              const zoomableElements = await page.locator('img, canvas, [data-zoomable]').count();
              
              if (zoomableElements > 0) {
                // ë·°í¬íŠ¸ ë©”íƒ€ íƒœê·¸ í™•ì¸
                const viewportMeta = await page.locator('meta[name="viewport"]').getAttribute('content');
                
                if (viewportMeta && viewportMeta.includes('user-scalable=no')) {
                  console.warn('âš ï¸ í•€ì¹˜ ì¤Œì´ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤');
                } else {
                  console.log('âœ… í•€ì¹˜ ì¤Œ í—ˆìš©ë¨');
                }
                
                // ì ‘ê·¼ì„±ì„ ìœ„í•´ ì¤Œì´ ê°€ëŠ¥í•´ì•¼ í•¨
                expect(viewportMeta).not.toContain('user-scalable=no');
              }
            });
          });
          EOF
          
          npx playwright test touch-interaction-test.js --reporter=json:touch-results.json

      - name: ğŸ§¹ ì„œë²„ ì •ë¦¬
        if: always()
        run: |
          if [ -n "$SERVER_PID" ]; then
            kill $SERVER_PID || true
          fi

      - name: ğŸ“¤ í„°ì¹˜ í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì—…ë¡œë“œ
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: touch-interaction-results
          path: touch-results.json
          retention-days: 7

  # í¬ë¡œìŠ¤ ë””ë°”ì´ìŠ¤ ì ‘ê·¼ì„± í…ŒìŠ¤íŠ¸
  accessibility-mobile:
    name: â™¿ ëª¨ë°”ì¼ ì ‘ê·¼ì„± í…ŒìŠ¤íŠ¸
    runs-on: ubuntu-latest
    timeout-minutes: 15
    
    steps:
      - name: ğŸ“¥ ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4

      - name: ğŸ”§ Node.js ì„¤ì •
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: ğŸ“¦ ì˜ì¡´ì„± ì„¤ì¹˜
        run: |
          npm ci --no-audit --no-fund
          npm install --no-save @axe-core/playwright
          npx playwright install chromium

      - name: ğŸ—ï¸ ë¹Œë“œ
        run: npm run build

      - name: ğŸš€ ì„œë²„ ì‹œì‘
        run: |
          npm start &
          SERVER_PID=$!
          echo "SERVER_PID=$SERVER_PID" >> $GITHUB_ENV
          
          echo "â³ ì„œë²„ ì‹œì‘ ëŒ€ê¸°..."
          for i in {1..30}; do
            if curl -s http://localhost:3000 > /dev/null; then
              echo "âœ… ì„œë²„ ì¤€ë¹„ ì™„ë£Œ"
              break
            fi
            sleep 2
          done

      - name: â™¿ ëª¨ë°”ì¼ ì ‘ê·¼ì„± ìŠ¤ìº”
        run: |
          cat > accessibility-mobile-test.js << 'EOF'
          const { test, expect, devices } = require('@playwright/test');
          const { injectAxe, checkA11y } = require('@axe-core/playwright');
          
          test.describe('Mobile Accessibility Tests', () => {
            // ë‹¤ì–‘í•œ ëª¨ë°”ì¼ ë””ë°”ì´ìŠ¤ì—ì„œ í…ŒìŠ¤íŠ¸
            const mobileDevices = ['iPhone 13', 'Pixel 5', 'Galaxy S21'];
            
            for (const deviceName of mobileDevices) {
              test(`Accessibility scan on ${deviceName}`, async ({ page }) => {
                await page.emulate(devices[deviceName]);
                await page.goto('http://localhost:3000');
                await page.waitForLoadState('networkidle');
                
                // Axe ì ‘ê·¼ì„± ë„êµ¬ ì£¼ì…
                await injectAxe(page);
                
                // ëª¨ë°”ì¼ íŠ¹í™” ì ‘ê·¼ì„± ê·œì¹™ìœ¼ë¡œ ê²€ì‚¬
                await checkA11y(page, null, {
                  rules: {
                    // ëª¨ë°”ì¼ì—ì„œ ì¤‘ìš”í•œ ì ‘ê·¼ì„± ê·œì¹™ë“¤
                    'color-contrast': { enabled: true },
                    'touch-target': { enabled: true },
                    'landmark-one-main': { enabled: true },
                    'page-has-heading-one': { enabled: true },
                    'focus-order-semantics': { enabled: true }
                  }
                });
                
                console.log(`âœ… ${deviceName} ì ‘ê·¼ì„± ê²€ì‚¬ í†µê³¼`);
              });
            }
          
            test('Screen reader navigation on mobile', async ({ page }) => {
              await page.emulate(devices['iPhone 13']);
              await page.goto('http://localhost:3000');
              await page.waitForLoadState('networkidle');
              
              // ìŠ¤í¬ë¦° ë¦¬ë”ë¥¼ ìœ„í•œ ìš”ì†Œë“¤ í™•ì¸
              const headings = await page.locator('h1, h2, h3, h4, h5, h6').count();
              const landmarks = await page.locator('[role="main"], [role="navigation"], [role="banner"], [role="contentinfo"]').count();
              const altTexts = await page.locator('img[alt]').count();
              const totalImages = await page.locator('img').count();
              
              console.log(`ğŸ“Š ì ‘ê·¼ì„± ìš”ì†Œ ë¶„ì„:`);
              console.log(`  ì œëª©: ${headings}ê°œ`);
              console.log(`  ëœë“œë§ˆí¬: ${landmarks}ê°œ`);
              console.log(`  Alt í…ìŠ¤íŠ¸: ${altTexts}/${totalImages} ì´ë¯¸ì§€`);
              
              // í•„ìˆ˜ ì ‘ê·¼ì„± ìš”ì†Œ ê²€ì¦
              expect(headings).toBeGreaterThan(0);
              expect(landmarks).toBeGreaterThan(0);
              
              if (totalImages > 0) {
                const altTextRatio = altTexts / totalImages;
                if (altTextRatio < 0.8) {
                  console.warn(`âš ï¸ Alt í…ìŠ¤íŠ¸ ë¶€ì¡±: ${(altTextRatio * 100).toFixed(1)}%`);
                }
              }
            });
          
            test('Keyboard navigation on mobile', async ({ page }) => {
              await page.emulate(devices['iPhone 13']);
              await page.goto('http://localhost:3000');
              await page.waitForLoadState('networkidle');
              
              // í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜ í…ŒìŠ¤íŠ¸
              const focusableElements = await page.locator('button, a, input, select, textarea, [tabindex]:not([tabindex="-1"])').count();
              
              console.log(`âŒ¨ï¸ í¬ì»¤ìŠ¤ ê°€ëŠ¥í•œ ìš”ì†Œ: ${focusableElements}ê°œ`);
              
              if (focusableElements > 0) {
                // Tab í‚¤ë¡œ ë„¤ë¹„ê²Œì´ì…˜ í…ŒìŠ¤íŠ¸
                for (let i = 0; i < Math.min(5, focusableElements); i++) {
                  await page.keyboard.press('Tab');
                  const focused = await page.evaluate(() => {
                    const el = document.activeElement;
                    return {
                      tagName: el.tagName,
                      className: el.className,
                      visible: el.offsetWidth > 0 && el.offsetHeight > 0
                    };
                  });
                  
                  if (!focused.visible) {
                    console.warn(`âš ï¸ í¬ì»¤ìŠ¤ëœ ìš”ì†Œê°€ ë³´ì´ì§€ ì•ŠìŒ: ${focused.tagName}.${focused.className}`);
                  }
                }
                
                console.log('âœ… í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜ í…ŒìŠ¤íŠ¸ ì™„ë£Œ');
              }
            });
          });
          EOF
          
          npx playwright test accessibility-mobile-test.js --reporter=json:accessibility-mobile-results.json

      - name: ğŸ§¹ ì„œë²„ ì •ë¦¬
        if: always()
        run: |
          if [ -n "$SERVER_PID" ]; then
            kill $SERVER_PID || true
          fi

      - name: ğŸ“¤ ì ‘ê·¼ì„± í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì—…ë¡œë“œ
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: accessibility-mobile-results
          path: accessibility-mobile-results.json
          retention-days: 7

  # ëª¨ë°”ì¼ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
  mobile-performance:
    name: ğŸ“± ëª¨ë°”ì¼ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
    runs-on: ubuntu-latest
    timeout-minutes: 20
    
    steps:
      - name: ğŸ“¥ ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4

      - name: ğŸ”§ Node.js ì„¤ì •
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: ğŸ“¦ ì˜ì¡´ì„± ì„¤ì¹˜
        run: |
          npm ci --no-audit --no-fund
          npm install --no-save lighthouse puppeteer

      - name: ğŸ—ï¸ ë¹Œë“œ
        run: npm run build

      - name: ğŸš€ ì„œë²„ ì‹œì‘
        run: |
          npm start &
          SERVER_PID=$!
          echo "SERVER_PID=$SERVER_PID" >> $GITHUB_ENV
          
          echo "â³ ì„œë²„ ì‹œì‘ ëŒ€ê¸°..."
          for i in {1..30}; do
            if curl -s http://localhost:3000 > /dev/null; then
              echo "âœ… ì„œë²„ ì¤€ë¹„ ì™„ë£Œ"
              break
            fi
            sleep 2
          done

      - name: ğŸ“± ëª¨ë°”ì¼ Lighthouse ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
        run: |
          cat > mobile-performance-test.js << 'EOF'
          const lighthouse = require('lighthouse');
          const chromeLauncher = require('chrome-launcher');
          const fs = require('fs');
          
          async function runMobileLighthouse() {
            const chrome = await chromeLauncher.launch({
              chromeFlags: ['--headless', '--no-sandbox', '--disable-dev-shm-usage']
            });
            
            const options = {
              logLevel: 'info',
              output: 'json',
              onlyCategories: ['performance', 'accessibility', 'best-practices', 'seo'],
              port: chrome.port,
              formFactor: 'mobile',
              screenEmulation: {
                mobile: true,
                width: 375,
                height: 667,
                deviceScaleFactor: 2,
                disabled: false,
              },
              throttling: {
                rttMs: 150,
                throughputKbps: 1638.4,
                cpuSlowdownMultiplier: 4,
                requestLatencyMs: 150 * 3.75,
                downloadThroughputKbps: 1638.4 * 0.9,
                uploadThroughputKbps: 675 * 0.9,
              }
            };
            
            const runnerResult = await lighthouse('http://localhost:3000', options);
            await chrome.kill();
            
            const report = runnerResult.lhr;
            
            const mobileMetrics = {
              performance: Math.round(report.categories.performance.score * 100),
              accessibility: Math.round(report.categories.accessibility.score * 100),
              bestPractices: Math.round(report.categories['best-practices'].score * 100),
              seo: Math.round(report.categories.seo.score * 100),
              fcp: report.audits['first-contentful-paint'].numericValue,
              lcp: report.audits['largest-contentful-paint'].numericValue,
              fid: report.audits['max-potential-fid']?.numericValue || 0,
              cls: report.audits['cumulative-layout-shift'].numericValue,
              tti: report.audits['interactive'].numericValue,
              speedIndex: report.audits['speed-index'].numericValue
            };
            
            fs.writeFileSync('mobile-lighthouse-results.json', JSON.stringify(report, null, 2));
            fs.writeFileSync('mobile-performance-metrics.json', JSON.stringify(mobileMetrics, null, 2));
            
            console.log('ğŸ“± ëª¨ë°”ì¼ Lighthouse ê²°ê³¼:');
            console.log(`  Performance: ${mobileMetrics.performance}/100 ğŸ¯ ëª©í‘œ: 80+`);
            console.log(`  Accessibility: ${mobileMetrics.accessibility}/100 ğŸ¯ ëª©í‘œ: 95+`);
            console.log(`  Best Practices: ${mobileMetrics.bestPractices}/100`);
            console.log(`  SEO: ${mobileMetrics.seo}/100`);
            console.log('\nğŸ“Š ëª¨ë°”ì¼ Core Web Vitals:');
            console.log(`  FCP: ${(mobileMetrics.fcp/1000).toFixed(2)}s ğŸ¯ ëª©í‘œ: <2.0s`);
            console.log(`  LCP: ${(mobileMetrics.lcp/1000).toFixed(2)}s ğŸ¯ ëª©í‘œ: <4.0s (ëª¨ë°”ì¼)`);
            console.log(`  CLS: ${mobileMetrics.cls.toFixed(3)} ğŸ¯ ëª©í‘œ: <0.1`);
            console.log(`  TTI: ${(mobileMetrics.tti/1000).toFixed(2)}s ğŸ¯ ëª©í‘œ: <5.0s`);
            console.log(`  Speed Index: ${(mobileMetrics.speedIndex/1000).toFixed(2)}s`);
            
            // ëª¨ë°”ì¼ íŠ¹í™” ì„±ëŠ¥ ê¸°ì¤€ ê²€ì¦
            const warnings = [];
            
            if (mobileMetrics.performance < 80) {
              warnings.push(`ëª¨ë°”ì¼ Performance ì ìˆ˜ ë¶€ì¡±: ${mobileMetrics.performance} < 80`);
            }
            
            if (mobileMetrics.lcp > 4000) {
              warnings.push(`ëª¨ë°”ì¼ LCP ë„ˆë¬´ ëŠë¦¼: ${(mobileMetrics.lcp/1000).toFixed(2)}s > 4.0s`);
            }
            
            if (mobileMetrics.fcp > 2000) {
              warnings.push(`ëª¨ë°”ì¼ FCP ë„ˆë¬´ ëŠë¦¼: ${(mobileMetrics.fcp/1000).toFixed(2)}s > 2.0s`);
            }
            
            if (mobileMetrics.tti > 5000) {
              warnings.push(`ëª¨ë°”ì¼ TTI ë„ˆë¬´ ëŠë¦¼: ${(mobileMetrics.tti/1000).toFixed(2)}s > 5.0s`);
            }
            
            if (warnings.length > 0) {
              console.log('\nâš ï¸ ëª¨ë°”ì¼ ì„±ëŠ¥ ê²½ê³ :');
              warnings.forEach(warning => console.log(`  - ${warning}`));
            } else {
              console.log('\nâœ… ëª¨ë“  ëª¨ë°”ì¼ ì„±ëŠ¥ ê¸°ì¤€ì„ ì¶©ì¡±í•©ë‹ˆë‹¤!');
            }
            
            return mobileMetrics;
          }
          
          runMobileLighthouse().catch(console.error);
          EOF
          
          node mobile-performance-test.js

      - name: ğŸ§¹ ì„œë²„ ì •ë¦¬
        if: always()
        run: |
          if [ -n "$SERVER_PID" ]; then
            kill $SERVER_PID || true
          fi

      - name: ğŸ“¤ ëª¨ë°”ì¼ ì„±ëŠ¥ ê²°ê³¼ ì—…ë¡œë“œ
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: mobile-performance-results
          path: |
            mobile-lighthouse-results.json
            mobile-performance-metrics.json
          retention-days: 30

  # ëª¨ë°”ì¼ í…ŒìŠ¤íŠ¸ ì¢…í•© ë¦¬í¬íŠ¸
  mobile-report:
    name: ğŸ“‹ ëª¨ë°”ì¼ í…ŒìŠ¤íŠ¸ ë¦¬í¬íŠ¸
    runs-on: ubuntu-latest
    needs: [responsive-design, touch-interaction, accessibility-mobile, mobile-performance]
    if: always()
    
    steps:
      - name: ğŸ“¥ ì•„í‹°íŒ©íŠ¸ ë‹¤ìš´ë¡œë“œ
        uses: actions/download-artifact@v4
        with:
          path: artifacts

      - name: ğŸ“Š ëª¨ë°”ì¼ í…ŒìŠ¤íŠ¸ ì¢…í•© ë¦¬í¬íŠ¸ ìƒì„±
        run: |
          echo "# ğŸ“± dduksangLAB ëª¨ë°”ì¼ í…ŒìŠ¤íŠ¸ ì¢…í•© ë¦¬í¬íŠ¸" > mobile-report.md
          echo "" >> mobile-report.md
          echo "ìƒì„± ì‹œê°„: $(date -u '+%Y-%m-%d %H:%M:%S UTC')" >> mobile-report.md
          echo "ì»¤ë°‹: ${{ github.sha }}" >> mobile-report.md
          echo "ë¸Œëœì¹˜: ${{ github.ref_name }}" >> mobile-report.md
          echo "" >> mobile-report.md
          
          # í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìš”ì•½
          echo "## ğŸ“Š í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìš”ì•½" >> mobile-report.md
          echo "| í…ŒìŠ¤íŠ¸ ìœ í˜• | ìƒíƒœ | ì„¤ëª… |" >> mobile-report.md
          echo "|------------|------|------|" >> mobile-report.md
          echo "| ë°˜ì‘í˜• ë””ìì¸ | ${{ needs.responsive-design.result == 'success' && 'âœ… í†µê³¼' || 'âŒ ì‹¤íŒ¨' }} | 6ê°€ì§€ ë·°í¬íŠ¸ í¬ê¸° ê²€ì¦ |" >> mobile-report.md
          echo "| í„°ì¹˜ ì¸í„°ë™ì…˜ | ${{ needs.touch-interaction.result == 'success' && 'âœ… í†µê³¼' || 'âŒ ì‹¤íŒ¨' }} | í„°ì¹˜ íƒ€ê²Ÿ, ì œìŠ¤ì²˜ í…ŒìŠ¤íŠ¸ |" >> mobile-report.md
          echo "| ëª¨ë°”ì¼ ì ‘ê·¼ì„± | ${{ needs.accessibility-mobile.result == 'success' && 'âœ… í†µê³¼' || 'âŒ ì‹¤íŒ¨' }} | 3ê°œ ë””ë°”ì´ìŠ¤ ì ‘ê·¼ì„± ê²€ì¦ |" >> mobile-report.md
          echo "| ëª¨ë°”ì¼ ì„±ëŠ¥ | ${{ needs.mobile-performance.result == 'success' && 'âœ… í†µê³¼' || 'âŒ ì‹¤íŒ¨' }} | ëª¨ë°”ì¼ íŠ¹í™” ì„±ëŠ¥ ì¸¡ì • |" >> mobile-report.md
          echo "" >> mobile-report.md
          
          # ëª¨ë°”ì¼ ì„±ëŠ¥ ì„¸ë¶€ì‚¬í•­
          echo "## âš¡ ëª¨ë°”ì¼ ì„±ëŠ¥ ì„¸ë¶€ì‚¬í•­" >> mobile-report.md
          if [ -f "artifacts/mobile-performance-results/mobile-performance-metrics.json" ]; then
            perf_metrics="artifacts/mobile-performance-results/mobile-performance-metrics.json"
            performance=$(jq -r '.performance // "N/A"' "$perf_metrics")
            accessibility=$(jq -r '.accessibility // "N/A"' "$perf_metrics")
            lcp=$(jq -r '.lcp // 0' "$perf_metrics")
            fcp=$(jq -r '.fcp // 0' "$perf_metrics")
            cls=$(jq -r '.cls // 0' "$perf_metrics")
            tti=$(jq -r '.tti // 0' "$perf_metrics")
            
            echo "### Lighthouse ëª¨ë°”ì¼ ì ìˆ˜" >> mobile-report.md
            echo "- Performance: ${performance}/100 ğŸ¯ ëª©í‘œ: 80+" >> mobile-report.md
            echo "- Accessibility: ${accessibility}/100 ğŸ¯ ëª©í‘œ: 95+" >> mobile-report.md
            echo "" >> mobile-report.md
            echo "### ëª¨ë°”ì¼ Core Web Vitals" >> mobile-report.md
            echo "- FCP: $(echo "scale=2; $fcp/1000" | bc -l)s ğŸ¯ ëª©í‘œ: <2.0s" >> mobile-report.md
            echo "- LCP: $(echo "scale=2; $lcp/1000" | bc -l)s ğŸ¯ ëª©í‘œ: <4.0s" >> mobile-report.md
            echo "- CLS: $cls ğŸ¯ ëª©í‘œ: <0.1" >> mobile-report.md
            echo "- TTI: $(echo "scale=2; $tti/1000" | bc -l)s ğŸ¯ ëª©í‘œ: <5.0s" >> mobile-report.md
          else
            echo "- ëª¨ë°”ì¼ ì„±ëŠ¥ ë°ì´í„° ì—†ìŒ" >> mobile-report.md
          fi
          echo "" >> mobile-report.md
          
          # ê°œì„  ê¶Œì¥ì‚¬í•­
          echo "## ğŸ“± ëª¨ë°”ì¼ ìµœì í™” ê¶Œì¥ì‚¬í•­" >> mobile-report.md
          echo "1. **í„°ì¹˜ íƒ€ê²Ÿ**: ìµœì†Œ 44x44px í¬ê¸° ìœ ì§€" >> mobile-report.md
          echo "2. **ì´ë¯¸ì§€ ìµœì í™”**: WebP/AVIF í¬ë§· ì‚¬ìš©, ì ì‘í˜• ì´ë¯¸ì§€" >> mobile-report.md
          echo "3. **í°íŠ¸ ë¡œë”©**: font-display: swap, ì‹œìŠ¤í…œ í°íŠ¸ ìš°ì„ " >> mobile-report.md
          echo "4. **JavaScript**: í•„ìˆ˜ ì½”ë“œë§Œ ìš°ì„  ë¡œë“œ, ì½”ë“œ ìŠ¤í”Œë¦¬íŒ…" >> mobile-report.md
          echo "5. **CSS**: Critical CSS ì¸ë¼ì¸, ë¯¸ì‚¬ìš© CSS ì œê±°" >> mobile-report.md
          echo "6. **ìºì‹±**: ì ê·¹ì ì¸ ë¸Œë¼ìš°ì € ìºì‹± ì „ëµ" >> mobile-report.md
          echo "7. **ì ‘ê·¼ì„±**: ì¶©ë¶„í•œ ìƒ‰ìƒ ëŒ€ë¹„, í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜" >> mobile-report.md
          echo "" >> mobile-report.md
          
          # ë°˜ì‘í˜• ë””ìì¸ ìƒíƒœ
          echo "## ğŸ“ ë°˜ì‘í˜• ë””ìì¸ ìƒíƒœ" >> mobile-report.md
          responsive_tests=$(find artifacts -name "responsive-test-*" -type d | wc -l)
          echo "- í…ŒìŠ¤íŠ¸ëœ ë·°í¬íŠ¸: ${responsive_tests}ê°œ" >> mobile-report.md
          echo "- ëª¨ë°”ì¼ ì„¸ë¡œ: 375x667px (iPhone SE)" >> mobile-report.md
          echo "- ëª¨ë°”ì¼ ê°€ë¡œ: 667x375px" >> mobile-report.md
          echo "- íƒœë¸”ë¦¿ ì„¸ë¡œ: 768x1024px (iPad)" >> mobile-report.md
          echo "- íƒœë¸”ë¦¿ ê°€ë¡œ: 1024x768px" >> mobile-report.md
          echo "- ë°ìŠ¤í¬í†±: 1920x1080px" >> mobile-report.md
          echo "- ëŒ€í˜• í™”ë©´: 2560x1440px" >> mobile-report.md
          
          cat mobile-report.md >> $GITHUB_STEP_SUMMARY

      - name: ğŸ“¤ ìµœì¢… ëª¨ë°”ì¼ ë¦¬í¬íŠ¸ ì—…ë¡œë“œ
        uses: actions/upload-artifact@v4
        with:
          name: mobile-test-report-${{ github.run_id }}
          path: mobile-report.md
          retention-days: 30
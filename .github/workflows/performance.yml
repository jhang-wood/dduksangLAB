name: ğŸš€ ì„±ëŠ¥ ìµœì í™” ë° ëª¨ë‹ˆí„°ë§

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]
  schedule:
    - cron: '0 2 * * *'  # ë§¤ì¼ ì˜¤ì „ 11ì‹œ (KST)
  workflow_dispatch:
    inputs:
      analysis_level:
        description: 'ë¶„ì„ ìˆ˜ì¤€'
        required: true
        default: 'standard'
        type: choice
        options:
          - minimal
          - standard
          - comprehensive

env:
  NODE_VERSION: '20'
  PERFORMANCE_BUDGET_SIZE: '500KB'
  PERFORMANCE_BUDGET_SPEED: '3000'

jobs:
  # Bundle ë¶„ì„ ë° ìµœì í™”
  bundle-analysis:
    name: ğŸ“¦ Bundle ë¶„ì„
    runs-on: ubuntu-latest
    timeout-minutes: 15
    
    steps:
      - name: ğŸ“¥ ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4
        with:
          fetch-depth: 2

      - name: ğŸ”§ Node.js ì„¤ì •
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: ğŸ“¦ ì˜ì¡´ì„± ì„¤ì¹˜
        run: |
          npm ci --no-audit --no-fund
          npm install --no-save @next/bundle-analyzer webpack-bundle-analyzer

      - name: ğŸ“Š Bundle Analyzer ì„¤ì •
        run: |
          cat > next.config.analyzer.js << 'EOF'
          const withBundleAnalyzer = require('@next/bundle-analyzer')({
            enabled: true,
            openAnalyzer: false
          })
          
          const nextConfig = {
            // ê¸°ì¡´ next.config.js ì„¤ì •ë“¤ì„ ì—¬ê¸°ì— ë³µì‚¬
            experimental: {
              optimizeCss: true,
            },
            compiler: {
              removeConsole: process.env.NODE_ENV === 'production',
            },
            images: {
              formats: ['image/avif', 'image/webp'],
              minimumCacheTTL: 31536000,
            }
          }
          
          module.exports = withBundleAnalyzer(nextConfig)
          EOF

      - name: ğŸ—ï¸ í”„ë¡œë•ì…˜ ë¹Œë“œ (Bundle ë¶„ì„ í¬í•¨)
        env:
          NEXT_PUBLIC_SUPABASE_URL: ${{ secrets.NEXT_PUBLIC_SUPABASE_URL || 'https://placeholder.supabase.co' }}
          NEXT_PUBLIC_SUPABASE_ANON_KEY: ${{ secrets.NEXT_PUBLIC_SUPABASE_ANON_KEY || 'placeholder_key' }}
        run: |
          echo "ğŸ”¨ Bundle ë¶„ì„ê³¼ í•¨ê»˜ í”„ë¡œë•ì…˜ ë¹Œë“œ ì‹œì‘..."
          cp next.config.analyzer.js next.config.js
          npm run build
          
          # Bundle í¬ê¸° ë¶„ì„
          if [ -d ".next/static" ]; then
            BUNDLE_SIZE=$(du -sm .next/static | cut -f1)
            JS_SIZE=$(find .next/static -name "*.js" -exec ls -la {} \; | awk '{sum += $5} END {print sum/1024/1024}' || echo "0")
            CSS_SIZE=$(find .next/static -name "*.css" -exec ls -la {} \; | awk '{sum += $5} END {print sum/1024/1024}' || echo "0")
            
            echo "bundle-total-size=${BUNDLE_SIZE}" >> $GITHUB_OUTPUT
            echo "bundle-js-size=${JS_SIZE}" >> $GITHUB_OUTPUT  
            echo "bundle-css-size=${CSS_SIZE}" >> $GITHUB_OUTPUT
            
            echo "ğŸ“Š Bundle í¬ê¸° ë¶„ì„:"
            echo "  ì „ì²´: ${BUNDLE_SIZE}MB"
            echo "  JS: ${JS_SIZE}MB"
            echo "  CSS: ${CSS_SIZE}MB"
            
            # í¬ê¸° ê²½ê³ 
            if [ "$BUNDLE_SIZE" -gt 10 ]; then
              echo "âš ï¸ Bundle í¬ê¸°ê°€ í½ë‹ˆë‹¤ (${BUNDLE_SIZE}MB > 10MB)"
              echo "::warning::Large bundle size: ${BUNDLE_SIZE}MB"
            fi
          fi

      - name: ğŸ“ˆ Bundle í¬ê¸° ë³€í™” ì¶”ì 
        if: github.event_name == 'pull_request'
        run: |
          echo "ğŸ“Š Bundle í¬ê¸° ë³€í™” ë¶„ì„..."
          
          # ì´ì „ ì»¤ë°‹ê³¼ ë¹„êµ
          git checkout HEAD~1
          npm run build
          PREV_BUNDLE_SIZE=$(du -sm .next/static 2>/dev/null | cut -f1 || echo "0")
          
          git checkout -
          npm run build
          CURR_BUNDLE_SIZE=$(du -sm .next/static 2>/dev/null | cut -f1 || echo "0")
          
          SIZE_DIFF=$((CURR_BUNDLE_SIZE - PREV_BUNDLE_SIZE))
          
          echo "Bundle í¬ê¸° ë³€í™”:"
          echo "  ì´ì „: ${PREV_BUNDLE_SIZE}MB"
          echo "  í˜„ì¬: ${CURR_BUNDLE_SIZE}MB"
          echo "  ë³€í™”: ${SIZE_DIFF}MB"
          
          if [ "$SIZE_DIFF" -gt 1 ]; then
            echo "âš ï¸ Bundle í¬ê¸°ê°€ í¬ê²Œ ì¦ê°€í–ˆìŠµë‹ˆë‹¤ (+${SIZE_DIFF}MB)"
            echo "::warning::Bundle size increased significantly: +${SIZE_DIFF}MB"
          elif [ "$SIZE_DIFF" -lt -1 ]; then
            echo "âœ… Bundle í¬ê¸°ê°€ ê°ì†Œí–ˆìŠµë‹ˆë‹¤ (${SIZE_DIFF}MB)"
          fi

      - name: ğŸ–¼ï¸ ì´ë¯¸ì§€ ìµœì í™” ê²€ì¦
        run: |
          echo "ğŸ” ì´ë¯¸ì§€ ìµœì í™” ìƒíƒœ ê²€ì‚¬..."
          
          # ì´ë¯¸ì§€ íŒŒì¼ ìŠ¤ìº”
          image_files=$(find public -type f \( -iname "*.jpg" -o -iname "*.jpeg" -o -iname "*.png" -o -iname "*.gif" -o -iname "*.svg" \) 2>/dev/null || echo "")
          
          if [ -n "$image_files" ]; then
            large_images=()
            total_size=0
            
            while IFS= read -r img; do
              size=$(stat -c%s "$img" 2>/dev/null || echo "0")
              size_mb=$(echo "scale=2; $size/1024/1024" | bc -l)
              total_size=$((total_size + size))
              
              echo "  $img: ${size_mb}MB"
              
              # 1MB ì´ìƒ ì´ë¯¸ì§€ ê²½ê³ 
              if [ "$size" -gt 1048576 ]; then
                large_images+=("$img (${size_mb}MB)")
              fi
            done <<< "$image_files"
            
            total_size_mb=$(echo "scale=2; $total_size/1024/1024" | bc -l)
            echo "ì´ ì´ë¯¸ì§€ í¬ê¸°: ${total_size_mb}MB"
            
            if [ ${#large_images[@]} -gt 0 ]; then
              echo "âš ï¸ 1MB ì´ìƒì˜ ëŒ€ìš©ëŸ‰ ì´ë¯¸ì§€ë“¤:"
              printf '%s\n' "${large_images[@]}"
              echo "::warning::Large images found that should be optimized"
            else
              echo "âœ… ëª¨ë“  ì´ë¯¸ì§€ê°€ ì ì ˆí•œ í¬ê¸°ì…ë‹ˆë‹¤"
            fi
          else
            echo "â„¹ï¸ ì´ë¯¸ì§€ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤"
          fi

      - name: ğŸ“Š Bundle ë¶„ì„ ë¦¬í¬íŠ¸ ìƒì„±
        if: always()
        run: |
          cat > bundle-report.json << EOF
          {
            "timestamp": "$(date -u +%Y-%m-%dT%H:%M:%SZ)",
            "commit": "${{ github.sha }}",
            "branch": "${{ github.ref_name }}",
            "total_size_mb": "${{ steps.*.outputs.bundle-total-size }}",
            "js_size_mb": "${{ steps.*.outputs.bundle-js-size }}",
            "css_size_mb": "${{ steps.*.outputs.bundle-css-size }}"
          }
          EOF

      - name: ğŸ“¤ Bundle ë¶„ì„ ì•„í‹°íŒ©íŠ¸ ì—…ë¡œë“œ
        uses: actions/upload-artifact@v4
        with:
          name: bundle-analysis-${{ github.sha }}
          path: |
            .next/analyze/
            bundle-report.json
          retention-days: 7

  # Core Web Vitals ë° ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
  performance-testing:
    name: âš¡ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
    runs-on: ubuntu-latest
    needs: bundle-analysis
    timeout-minutes: 20
    
    steps:
      - name: ğŸ“¥ ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4

      - name: ğŸ”§ Node.js ì„¤ì •
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: ğŸ“¦ ì˜ì¡´ì„± ì„¤ì¹˜
        run: |
          npm ci --no-audit --no-fund
          npm install --no-save @playwright/test lighthouse puppeteer

      - name: ğŸ—ï¸ ë¹Œë“œ
        run: npm run build

      - name: ğŸš€ ì„œë²„ ì‹œì‘
        run: |
          npm start &
          echo "SERVER_PID=$!" >> $GITHUB_ENV
          
          # ì„œë²„ ì¤€ë¹„ ëŒ€ê¸°
          echo "â³ ì„œë²„ ì‹œì‘ ëŒ€ê¸°..."
          for i in {1..30}; do
            if curl -s http://localhost:3000 > /dev/null; then
              echo "âœ… ì„œë²„ê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤"
              break
            fi
            echo "ì„œë²„ ì‹œì‘ ëŒ€ê¸° ì¤‘... ($i/30)"
            sleep 2
          done

      - name: ğŸ“Š Lighthouse ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
        run: |
          echo "ğŸ” Lighthouse ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ì‹¤í–‰..."
          
          cat > performance-test.js << 'EOF'
          const lighthouse = require('lighthouse');
          const chromeLauncher = require('chrome-launcher');
          const fs = require('fs');
          
          async function runLighthouse() {
            const chrome = await chromeLauncher.launch({chromeFlags: ['--headless', '--no-sandbox', '--disable-dev-shm-usage']});
            const options = {
              logLevel: 'info',
              output: 'json',
              onlyCategories: ['performance', 'accessibility', 'best-practices', 'seo'],
              port: chrome.port,
            };
            
            const runnerResult = await lighthouse('http://localhost:3000', options);
            await chrome.kill();
            
            const report = runnerResult.lhr;
            
            // Core Web Vitals ì¶”ì¶œ
            const metrics = {
              performance: Math.round(report.categories.performance.score * 100),
              accessibility: Math.round(report.categories.accessibility.score * 100),
              bestPractices: Math.round(report.categories['best-practices'].score * 100),
              seo: Math.round(report.categories.seo.score * 100),
              fcp: report.audits['first-contentful-paint'].numericValue,
              lcp: report.audits['largest-contentful-paint'].numericValue,
              cls: report.audits['cumulative-layout-shift'].numericValue,
              fid: report.audits['max-potential-fid']?.numericValue || 0,
              ttfb: report.audits['server-response-time'].numericValue
            };
            
            fs.writeFileSync('lighthouse-results.json', JSON.stringify(report, null, 2));
            fs.writeFileSync('performance-metrics.json', JSON.stringify(metrics, null, 2));
            
            console.log('ğŸ“Š Lighthouse ê²°ê³¼:');
            console.log(`  Performance: ${metrics.performance}/100`);
            console.log(`  Accessibility: ${metrics.accessibility}/100`);
            console.log(`  Best Practices: ${metrics.bestPractices}/100`);
            console.log(`  SEO: ${metrics.seo}/100`);
            console.log('\nâš¡ Core Web Vitals:');
            console.log(`  FCP: ${(metrics.fcp/1000).toFixed(2)}s`);
            console.log(`  LCP: ${(metrics.lcp/1000).toFixed(2)}s`);
            console.log(`  CLS: ${metrics.cls.toFixed(3)}`);
            console.log(`  TTFB: ${(metrics.ttfb/1000).toFixed(2)}s`);
            
            return metrics;
          }
          
          runLighthouse().catch(console.error);
          EOF
          
          node performance-test.js

      - name: ğŸ“ˆ ì„±ëŠ¥ ê¸°ì¤€ ê²€ì¦
        run: |
          echo "ğŸ¯ ì„±ëŠ¥ ê¸°ì¤€ ê²€ì¦..."
          
          if [ -f "performance-metrics.json" ]; then
            performance=$(jq -r '.performance' performance-metrics.json)
            accessibility=$(jq -r '.accessibility' performance-metrics.json)
            lcp=$(jq -r '.lcp' performance-metrics.json)
            cls=$(jq -r '.cls' performance-metrics.json)
            
            echo "í˜„ì¬ ì ìˆ˜:"
            echo "  Performance: $performance/100 (ëª©í‘œ: 90+)"
            echo "  Accessibility: $accessibility/100 (ëª©í‘œ: 95+)"
            echo "  LCP: $(echo "scale=2; $lcp/1000" | bc -l)s (ëª©í‘œ: <2.5s)"
            echo "  CLS: $cls (ëª©í‘œ: <0.1)"
            
            failures=()
            
            if [ "$performance" -lt 90 ]; then
              failures+=("Performance ì ìˆ˜ ë¶€ì¡±: $performance < 90")
            fi
            
            if [ "$accessibility" -lt 95 ]; then
              failures+=("Accessibility ì ìˆ˜ ë¶€ì¡±: $accessibility < 95")
            fi
            
            if [ "$(echo "$lcp > 2500" | bc -l)" -eq 1 ]; then
              failures+=("LCP ë„ˆë¬´ ëŠë¦¼: $(echo "scale=2; $lcp/1000" | bc -l)s > 2.5s")
            fi
            
            if [ "$(echo "$cls > 0.1" | bc -l)" -eq 1 ]; then
              failures+=("CLS ë„ˆë¬´ ë†’ìŒ: $cls > 0.1")
            fi
            
            if [ ${#failures[@]} -gt 0 ]; then
              echo "âŒ ì„±ëŠ¥ ê¸°ì¤€ ë¯¸ë‹¬:"
              printf '%s\n' "${failures[@]}"
              echo "::warning::Performance standards not met"
            else
              echo "âœ… ëª¨ë“  ì„±ëŠ¥ ê¸°ì¤€ì„ ì¶©ì¡±í•©ë‹ˆë‹¤!"
            fi
          fi

      - name: ğŸ§¹ ì„œë²„ ì •ë¦¬
        if: always()
        run: |
          if [ -n "$SERVER_PID" ]; then
            kill $SERVER_PID || true
          fi
          pkill -f "next start" || true

      - name: ğŸ“¤ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì—…ë¡œë“œ
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: performance-results-${{ github.sha }}
          path: |
            lighthouse-results.json
            performance-metrics.json
          retention-days: 30

  # ì´ë¯¸ì§€ ë° ì—ì…‹ ìµœì í™” ê²€ì¦
  asset-optimization:
    name: ğŸ–¼ï¸ ì—ì…‹ ìµœì í™”
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
      - name: ğŸ“¥ ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4

      - name: ğŸ”§ ì´ë¯¸ì§€ ìµœì í™” ë„êµ¬ ì„¤ì¹˜
        run: |
          npm install --no-save imagemin imagemin-mozjpeg imagemin-pngquant imagemin-svgo
          
      - name: ğŸ“Š ì´ë¯¸ì§€ ìµœì í™” ë¶„ì„
        run: |
          cat > image-optimizer.js << 'EOF'
          const imagemin = require('imagemin');
          const imageminMozjpeg = require('imagemin-mozjpeg');
          const imageminPngquant = require('imagemin-pngquant');
          const imageminSvgo = require('imagemin-svgo');
          const fs = require('fs');
          const path = require('path');
          
          async function analyzeImages() {
            const publicDir = 'public';
            if (!fs.existsSync(publicDir)) {
              console.log('ğŸ“ public ë””ë ‰í† ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤');
              return;
            }
            
            // ì´ë¯¸ì§€ íŒŒì¼ ì°¾ê¸°
            function findImages(dir) {
              const images = [];
              const files = fs.readdirSync(dir);
              
              for (const file of files) {
                const filePath = path.join(dir, file);
                const stat = fs.statSync(filePath);
                
                if (stat.isDirectory()) {
                  images.push(...findImages(filePath));
                } else if (/\.(jpg|jpeg|png|svg)$/i.test(file)) {
                  images.push(filePath);
                }
              }
              
              return images;
            }
            
            const images = findImages(publicDir);
            console.log(`ğŸ” ë°œê²¬ëœ ì´ë¯¸ì§€: ${images.length}ê°œ`);
            
            let totalOriginalSize = 0;
            let totalOptimizedSize = 0;
            const optimizationResults = [];
            
            for (const imagePath of images) {
              const originalSize = fs.statSync(imagePath).size;
              totalOriginalSize += originalSize;
              
              try {
                const optimized = await imagemin([imagePath], {
                  plugins: [
                    imageminMozjpeg({quality: 80}),
                    imageminPngquant({quality: [0.6, 0.8]}),
                    imageminSvgo()
                  ]
                });
                
                if (optimized.length > 0) {
                  const optimizedSize = optimized[0].data.length;
                  totalOptimizedSize += optimizedSize;
                  
                  const savings = originalSize - optimizedSize;
                  const savingsPercent = ((savings / originalSize) * 100).toFixed(1);
                  
                  optimizationResults.push({
                    path: imagePath,
                    originalSize: originalSize,
                    optimizedSize: optimizedSize,
                    savings: savings,
                    savingsPercent: savingsPercent
                  });
                  
                  console.log(`ğŸ“· ${imagePath}: ${(originalSize/1024).toFixed(1)}KB â†’ ${(optimizedSize/1024).toFixed(1)}KB (-${savingsPercent}%)`);
                }
              } catch (error) {
                console.log(`âŒ ${imagePath} ìµœì í™” ì‹¤íŒ¨:`, error.message);
              }
            }
            
            const totalSavings = totalOriginalSize - totalOptimizedSize;
            const totalSavingsPercent = ((totalSavings / totalOriginalSize) * 100).toFixed(1);
            
            console.log(`\nğŸ“Š ì „ì²´ ìµœì í™” ê²°ê³¼:`);
            console.log(`  ì›ë³¸ í¬ê¸°: ${(totalOriginalSize/1024/1024).toFixed(2)}MB`);
            console.log(`  ìµœì í™” í›„: ${(totalOptimizedSize/1024/1024).toFixed(2)}MB`);
            console.log(`  ì ˆì•½: ${(totalSavings/1024/1024).toFixed(2)}MB (-${totalSavingsPercent}%)`);
            
            fs.writeFileSync('image-optimization.json', JSON.stringify({
              totalImages: images.length,
              totalOriginalSize,
              totalOptimizedSize,
              totalSavings,
              totalSavingsPercent,
              results: optimizationResults
            }, null, 2));
            
            if (totalSavingsPercent > 20) {
              console.log(`âš ï¸ ì´ë¯¸ì§€ ìµœì í™”ë¡œ ${totalSavingsPercent}% ì ˆì•½ ê°€ëŠ¥í•©ë‹ˆë‹¤!`);
            } else {
              console.log(`âœ… ì´ë¯¸ì§€ê°€ ì˜ ìµœì í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤`);
            }
          }
          
          analyzeImages().catch(console.error);
          EOF
          
          node image-optimizer.js

      - name: ğŸ“¦ ì •ì  ì—ì…‹ ë¶„ì„
        run: |
          echo "ğŸ“Š ì •ì  ì—ì…‹ ë¶„ì„..."
          
          if [ -d "public" ]; then
            # ì „ì²´ public ë””ë ‰í† ë¦¬ í¬ê¸°
            public_size=$(du -sm public | cut -f1)
            echo "Public ë””ë ‰í† ë¦¬ í¬ê¸°: ${public_size}MB"
            
            # íŒŒì¼ ìœ í˜•ë³„ ë¶„ì„
            echo "\nğŸ“ íŒŒì¼ ìœ í˜•ë³„ ë¶„ì„:"
            find public -type f -exec file {} \; | awk -F: '{print $2}' | sort | uniq -c | sort -nr
            
            # í° íŒŒì¼ë“¤ ì°¾ê¸°
            echo "\nğŸ“ 1MB ì´ìƒ íŒŒì¼ë“¤:"
            find public -type f -size +1M -exec ls -lh {} \; | awk '{print $5 " " $9}' || echo "1MB ì´ìƒ íŒŒì¼ ì—†ìŒ"
            
            if [ "$public_size" -gt 50 ]; then
              echo "âš ï¸ Public ë””ë ‰í† ë¦¬ê°€ í½ë‹ˆë‹¤ (${public_size}MB > 50MB)"
              echo "::warning::Large public directory: ${public_size}MB"
            fi
          else
            echo "â„¹ï¸ public ë””ë ‰í† ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤"
          fi

      - name: ğŸ“¤ ì—ì…‹ ë¶„ì„ ê²°ê³¼ ì—…ë¡œë“œ
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: asset-optimization-${{ github.sha }}
          path: |
            image-optimization.json
          retention-days: 7

  # ì„±ëŠ¥ ë¦¬í¬íŠ¸ ìƒì„±
  performance-report:
    name: ğŸ“Š ì„±ëŠ¥ ë¦¬í¬íŠ¸
    runs-on: ubuntu-latest
    needs: [bundle-analysis, performance-testing, asset-optimization]
    if: always()
    
    steps:
      - name: ğŸ“¥ ì•„í‹°íŒ©íŠ¸ ë‹¤ìš´ë¡œë“œ
        uses: actions/download-artifact@v4
        with:
          path: artifacts

      - name: ğŸ“‹ í†µí•© ì„±ëŠ¥ ë¦¬í¬íŠ¸ ìƒì„±
        run: |
          echo "# ğŸš€ dduksangLAB ì„±ëŠ¥ ë¶„ì„ ë¦¬í¬íŠ¸" > performance-report.md
          echo "" >> performance-report.md
          echo "ìƒì„± ì‹œê°„: $(date -u '+%Y-%m-%d %H:%M:%S UTC')" >> performance-report.md
          echo "ì»¤ë°‹: ${{ github.sha }}" >> performance-report.md
          echo "ë¸Œëœì¹˜: ${{ github.ref_name }}" >> performance-report.md
          echo "" >> performance-report.md
          
          # Bundle ë¶„ì„ ê²°ê³¼
          echo "## ğŸ“¦ Bundle ë¶„ì„" >> performance-report.md
          if [ -f "artifacts/bundle-analysis-*/bundle-report.json" ]; then
            bundle_report=$(find artifacts -name "bundle-report.json" | head -1)
            total_size=$(jq -r '.total_size_mb // "N/A"' "$bundle_report")
            js_size=$(jq -r '.js_size_mb // "N/A"' "$bundle_report")
            css_size=$(jq -r '.css_size_mb // "N/A"' "$bundle_report")
            
            echo "- ì „ì²´ Bundle í¬ê¸°: ${total_size}MB" >> performance-report.md
            echo "- JavaScript í¬ê¸°: ${js_size}MB" >> performance-report.md
            echo "- CSS í¬ê¸°: ${css_size}MB" >> performance-report.md
          else
            echo "- Bundle ë¶„ì„ ë°ì´í„° ì—†ìŒ" >> performance-report.md
          fi
          echo "" >> performance-report.md
          
          # ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ê²°ê³¼
          echo "## âš¡ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ê²°ê³¼" >> performance-report.md
          if [ -f "artifacts/performance-results-*/performance-metrics.json" ]; then
            perf_metrics=$(find artifacts -name "performance-metrics.json" | head -1)
            performance=$(jq -r '.performance // "N/A"' "$perf_metrics")
            accessibility=$(jq -r '.accessibility // "N/A"' "$perf_metrics")
            lcp=$(jq -r '.lcp // 0' "$perf_metrics")
            cls=$(jq -r '.cls // 0' "$perf_metrics")
            
            echo "### Lighthouse ì ìˆ˜" >> performance-report.md
            echo "- Performance: ${performance}/100 ğŸ¯ ëª©í‘œ: 90+" >> performance-report.md
            echo "- Accessibility: ${accessibility}/100 ğŸ¯ ëª©í‘œ: 95+" >> performance-report.md
            echo "" >> performance-report.md
            echo "### Core Web Vitals" >> performance-report.md
            echo "- LCP: $(echo "scale=2; $lcp/1000" | bc -l)s ğŸ¯ ëª©í‘œ: <2.5s" >> performance-report.md
            echo "- CLS: $cls ğŸ¯ ëª©í‘œ: <0.1" >> performance-report.md
          else
            echo "- ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ë°ì´í„° ì—†ìŒ" >> performance-report.md
          fi
          echo "" >> performance-report.md
          
          # ê¶Œì¥ì‚¬í•­
          echo "## ğŸ’¡ ìµœì í™” ê¶Œì¥ì‚¬í•­" >> performance-report.md
          echo "1. **Bundle í¬ê¸° ê´€ë¦¬**: ì½”ë“œ ìŠ¤í”Œë¦¬íŒ… ë° dynamic import í™œìš©" >> performance-report.md
          echo "2. **ì´ë¯¸ì§€ ìµœì í™”**: Next.js Image ì»´í¬ë„ŒíŠ¸ ì ê·¹ í™œìš©" >> performance-report.md
          echo "3. **í°íŠ¸ ìµœì í™”**: font-display: swap ì„¤ì •" >> performance-report.md
          echo "4. **ìºì‹± ì „ëµ**: ì ì ˆí•œ Cache-Control í—¤ë” ì„¤ì •" >> performance-report.md
          echo "5. **Core Web Vitals**: ì§€ì†ì ì¸ ëª¨ë‹ˆí„°ë§ ë° ê°œì„ " >> performance-report.md
          
          cat performance-report.md >> $GITHUB_STEP_SUMMARY

      - name: ğŸ“¤ ìµœì¢… ë¦¬í¬íŠ¸ ì—…ë¡œë“œ
        uses: actions/upload-artifact@v4
        with:
          name: performance-report-${{ github.run_id }}
          path: performance-report.md
          retention-days: 30
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>dduksangLAB UI Test Suite</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; margin: 20px; }
        .test-container { max-width: 1200px; margin: 0 auto; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .test-item { margin: 10px 0; padding: 10px; background: #f9f9f9; border-radius: 4px; }
        .test-result { margin-left: 10px; font-weight: bold; }
        .pass { color: #22c55e; }
        .fail { color: #ef4444; }
        .warn { color: #f59e0b; }
        button { padding: 10px 20px; margin: 5px; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #2563eb; }
        .screenshot-area { margin: 20px 0; }
        iframe { width: 100%; height: 600px; border: 1px solid #ddd; border-radius: 8px; margin: 10px 0; }
        .mobile-view { width: 375px; height: 667px; }
        .desktop-view { width: 100%; height: 800px; }
        #results { margin-top: 20px; padding: 15px; background: #f3f4f6; border-radius: 8px; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>🧪 dduksangLAB UI 완전 테스트 도구</h1>
        <p>모든 버튼과 기능을 하나하나 클릭하면서 테스트합니다.</p>
        
        <div class="test-section">
            <h2>🚀 자동 테스트 시작</h2>
            <button onclick="startComprehensiveTest()">전체 UI 테스트 시작</button>
            <button onclick="testSpecificPage()">특정 페이지 테스트</button>
            <button onclick="testMobileResponsive()">모바일 반응형 테스트</button>
            <button onclick="generateReport()">테스트 리포트 생성</button>
        </div>

        <div class="test-section">
            <h2>📱 페이지별 미리보기 & 테스트</h2>
            <div>
                <button onclick="loadPage('/')">메인 페이지</button>
                <button onclick="loadPage('/lectures')">강의 페이지</button>
                <button onclick="loadPage('/ai-trends')">AI 트렌드</button>
                <button onclick="loadPage('/community')">커뮤니티</button>
                <button onclick="loadPage('/auth/login')">로그인</button>
                <button onclick="loadPage('/auth/signup')">회원가입</button>
            </div>
            <div class="screenshot-area">
                <iframe id="preview-frame" class="desktop-view" src="http://localhost:3000"></iframe>
            </div>
        </div>

        <div class="test-section">
            <h2>🔍 실시간 테스트 결과</h2>
            <div id="results">테스트를 시작하려면 위의 버튼을 클릭하세요.</div>
        </div>

        <div class="test-section">
            <h2>📊 발견된 문제점 목록</h2>
            <div id="issues-list">문제점이 발견되면 여기에 표시됩니다.</div>
        </div>
    </div>

    <script>
        let testResults = [];
        let issues = [];
        
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'pass' ? '#22c55e' : type === 'fail' ? '#ef4444' : type === 'warn' ? '#f59e0b' : '#374151';
            results.innerHTML += `<div style="color: ${color}; margin: 5px 0;">[${timestamp}] ${message}</div>`;
            results.scrollTop = results.scrollHeight;
        }

        function addIssue(issue) {
            issues.push(issue);
            const issuesList = document.getElementById('issues-list');
            issuesList.innerHTML += `<div style="color: #ef4444; margin: 5px 0; padding: 8px; background: #fee2e2; border-radius: 4px;">❌ ${issue}</div>`;
        }

        function loadPage(path) {
            const frame = document.getElementById('preview-frame');
            frame.src = `http://localhost:3000${path}`;
            log(`페이지 로딩: ${path}`, 'info');
            
            // 페이지 로드 후 자동 테스트
            setTimeout(() => {
                testCurrentPage(path);
            }, 2000);
        }

        function testCurrentPage(path) {
            const frame = document.getElementById('preview-frame');
            try {
                const frameDoc = frame.contentDocument || frame.contentWindow.document;
                
                // 기본 요소 체크
                const hasHeader = frameDoc.querySelector('header, nav, [role="navigation"]');
                const hasMain = frameDoc.querySelector('main, [role="main"], .main-content');
                const hasFooter = frameDoc.querySelector('footer, [role="contentinfo"]');
                
                if (hasHeader) {
                    log(`✅ ${path}: 헤더 발견`, 'pass');
                } else {
                    log(`❌ ${path}: 헤더 없음`, 'fail');
                    addIssue(`${path} 페이지에 헤더가 없습니다`);
                }
                
                if (hasMain) {
                    log(`✅ ${path}: 메인 콘텐츠 영역 발견`, 'pass');
                } else {
                    log(`⚠️ ${path}: 메인 콘텐츠 영역 불명확`, 'warn');
                }
                
                // 버튼 및 링크 체크
                const buttons = frameDoc.querySelectorAll('button, input[type="button"], input[type="submit"]');
                const links = frameDoc.querySelectorAll('a[href]');
                
                log(`📊 ${path}: 버튼 ${buttons.length}개, 링크 ${links.length}개 발견`, 'info');
                
                // 폼 요소 체크
                const forms = frameDoc.querySelectorAll('form');
                const inputs = frameDoc.querySelectorAll('input, textarea, select');
                
                if (forms.length > 0) {
                    log(`📝 ${path}: 폼 ${forms.length}개, 입력 필드 ${inputs.length}개 발견`, 'info');
                }
                
                // 이미지 체크
                const images = frameDoc.querySelectorAll('img');
                let brokenImages = 0;
                images.forEach(img => {
                    if (!img.complete || img.naturalHeight === 0) {
                        brokenImages++;
                    }
                });
                
                if (brokenImages > 0) {
                    log(`❌ ${path}: 깨진 이미지 ${brokenImages}개 발견`, 'fail');
                    addIssue(`${path} 페이지에 깨진 이미지 ${brokenImages}개`);
                } else if (images.length > 0) {
                    log(`✅ ${path}: 모든 이미지(${images.length}개) 정상`, 'pass');
                }
                
                // JavaScript 오류 체크 (제한적)
                const scripts = frameDoc.querySelectorAll('script');
                log(`⚙️ ${path}: 스크립트 ${scripts.length}개 로드됨`, 'info');
                
            } catch (error) {
                log(`❌ ${path}: 페이지 분석 실패 - ${error.message}`, 'fail');
                addIssue(`${path} 페이지 분석 중 오류: ${error.message}`);
            }
        }

        function startComprehensiveTest() {
            log('🚀 전체 UI 테스트 시작!', 'info');
            issues = [];
            
            const pages = ['/', '/lectures', '/ai-trends', '/community', '/auth/login', '/auth/signup'];
            let currentPageIndex = 0;
            
            function testNextPage() {
                if (currentPageIndex < pages.length) {
                    const page = pages[currentPageIndex];
                    log(`🔍 테스트 중: ${page}`, 'info');
                    loadPage(page);
                    currentPageIndex++;
                    setTimeout(testNextPage, 4000); // 4초 대기 후 다음 페이지
                } else {
                    log('✅ 모든 페이지 테스트 완료!', 'pass');
                    generateReport();
                }
            }
            
            testNextPage();
        }

        function testSpecificPage() {
            const path = prompt('테스트할 페이지 경로를 입력하세요 (예: /lectures):');
            if (path) {
                loadPage(path);
            }
        }

        function testMobileResponsive() {
            log('📱 모바일 반응형 테스트 시작', 'info');
            const frame = document.getElementById('preview-frame');
            frame.className = 'mobile-view';
            
            // 메인 페이지로 이동
            loadPage('/');
            
            setTimeout(() => {
                frame.className = 'desktop-view';
                log('🖥️ 데스크톱 뷰로 복원', 'info');
            }, 10000);
        }

        function generateReport() {
            log('📊 테스트 리포트 생성 중...', 'info');
            
            const totalTests = testResults.length;
            const passedTests = testResults.filter(t => t.status === 'pass').length;
            const failedTests = testResults.filter(t => t.status === 'fail').length;
            
            const report = `
                <h3>📋 최종 테스트 리포트</h3>
                <p><strong>테스트 완료 시간:</strong> ${new Date().toLocaleString()}</p>
                <p><strong>총 발견된 문제점:</strong> ${issues.length}개</p>
                <p><strong>테스트 상태:</strong> ${issues.length === 0 ? '✅ 모든 테스트 통과' : '❌ 문제점 발견'}</p>
                
                <h4>🎯 권장 조치사항:</h4>
                <ul>
                    ${issues.length === 0 ? '<li>✅ 추가 개선사항 없음 - 배포 준비 완료!</li>' : 
                      issues.map(issue => `<li>🔧 ${issue}</li>`).join('')}
                </ul>
            `;
            
            const results = document.getElementById('results');
            results.innerHTML += `<div style="margin-top: 20px; padding: 15px; background: white; border-radius: 8px; border: 1px solid #ddd;">${report}</div>`;
        }

        // 초기 페이지 로드
        window.onload = function() {
            log('🎯 dduksangLAB UI 테스트 도구 준비 완료', 'pass');
            log('💡 왼쪽 버튼들을 클릭하여 테스트를 시작하세요', 'info');
        };

        // 주기적으로 서버 상태 체크
        function checkServerStatus() {
            fetch('http://localhost:3000')
                .then(response => {
                    if (response.ok) {
                        log('✅ 서버 연결 정상', 'pass');
                    } else {
                        log('⚠️ 서버 응답 이상', 'warn');
                    }
                })
                .catch(error => {
                    log('❌ 서버 연결 실패', 'fail');
                    addIssue('서버가 실행 중이 아닙니다');
                });
        }

        // 5초마다 서버 상태 체크
        setInterval(checkServerStatus, 5000);
        checkServerStatus(); // 초기 체크
    </script>
</body>
</html>
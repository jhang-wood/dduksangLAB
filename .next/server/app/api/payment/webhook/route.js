(()=>{var e={};e.id=958,e.ids=[958],e.modules={30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},41808:e=>{"use strict";e.exports=require("net")},85477:e=>{"use strict";e.exports=require("punycode")},12781:e=>{"use strict";e.exports=require("stream")},24404:e=>{"use strict";e.exports=require("tls")},57310:e=>{"use strict";e.exports=require("url")},59796:e=>{"use strict";e.exports=require("zlib")},58359:()=>{},93739:()=>{},36208:(e,t,r)=>{"use strict";r.r(t),r.d(t,{headerHooks:()=>g,originalPathname:()=>h,requestAsyncStorage:()=>l,routeModule:()=>m,serverHooks:()=>_,staticGenerationAsyncStorage:()=>y,staticGenerationBailout:()=>I});var s={};r.r(s),r.d(s,{POST:()=>POST});var a=r(10884),o=r(16132),i=r(95798),u=r(16163);let n=(0,u.eI)("https://wpzvocfgfwvsxmpckdnu.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndwenZvY2ZnZnd2c3htcGNrZG51Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI2Njc4NTIsImV4cCI6MjA2ODI0Mzg1Mn0.LlO3iM55sbzXexcCExkDsSH448J2Z-NJUT1aZQCdck8");var p=r(6113),c=r.n(p);let d={secretKey:process.env.PAYAPP_SECRET_KEY||"2m/tdA5GmmwTLP/KWo9V7e1DPJnCCRVaOgT+oqg6zaM=",value:process.env.PAYAPP_VALUE||"2m/tdA5GmmwTLP/KWo9V7c0BU4QO/tDrbfcHeaukANY=",userCode:"BA0209",storeId:"dduksanglab",testMode:!0};function generatePayAppSignature(e){let t=Object.keys(e).sort(),r=t.map(t=>`${t}=${e[t]}`).join("&"),s=r+d.value,a=c().createHmac("sha256",d.secretKey).update(s).digest("base64");return a}function verifyPayAppWebhook(e,t){let r=generatePayAppSignature(e);return r===t}async function POST(e){try{let t=await e.json(),r=e.headers.get("X-PayApp-Signature");if(!r||!verifyPayAppWebhook(t,r))return i.Z.json({error:"Invalid signature"},{status:401});if("paid"===t.status){let{error:e}=await n.from("users").update({user_type:"student",payment_status:"paid",last_payment_date:new Date().toISOString()}).eq("email",t.user_email);if(e)return console.error("사용자 업데이트 실패:",e),i.Z.json({error:"User update failed"},{status:500});let{data:r}=await n.from("users").select("id").eq("email",t.user_email).single();r&&await n.from("payments").insert({user_id:r.id,order_id:t.order_no,payapp_order_id:t.payapp_order_id,amount:t.amount,status:"completed",created_at:new Date().toISOString()})}return i.Z.json({success:!0})}catch(e){return console.error("Webhook 처리 오류:",e),i.Z.json({error:"Internal server error"},{status:500})}}let m=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/payment/webhook/route",pathname:"/api/payment/webhook",filename:"route",bundlePath:"app/api/payment/webhook/route"},resolvedPagePath:"/home/qwg18/dduksangLAB/app/api/payment/webhook/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:l,staticGenerationAsyncStorage:y,serverHooks:_,headerHooks:g,staticGenerationBailout:I}=m,h="/api/payment/webhook/route"}};var t=require("../../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[613],()=>__webpack_exec__(36208));module.exports=r})();